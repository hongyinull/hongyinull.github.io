

<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>VoteNow å³æ™‚é–‹ç¥¨</title>
  <style>
    body {
      margin: 0;
      font-family: "Helvetica Neue", sans-serif;
      background-image: url("Assets/paper.jpg");
      background-size: cover;
      background-repeat: no-repeat;
      background-attachment: fixed;
      background-position: center;
      color: #000;
    }
    .container {
      max-width: 600px;
      margin: auto;
      padding: 1rem;
    }
    .header {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      font-size: 1.75rem;
      font-weight: bold;
    }
    .subheader {
      font-size: 1.25rem;
      font-weight: bold;
      margin-bottom: 1rem;
    }
    .candidate {
      background-color: rgba(255, 255, 255, 0.85);
      border-radius: 10px;
      padding: 1rem;
      margin-bottom: 1rem;
    }
    /* æ¡Œæ©Ÿä¸‰æ¬„å¡ç‰‡æ’ç‰ˆ */
    @media (min-width: 1024px) {
      #list {
        display: grid;
        grid-template-columns: repeat(3, 1fr);
        gap: 1rem;
      }
      .candidate {
        margin-bottom: 0; /* ç”± grid æ§åˆ¶ */
      }
    }
    .top {
      display: flex;
      align-items: center;
    }
    .avatar {
      width: 48px;
      height: 48px;
      border-radius: 50%;
      object-fit: cover;
      margin-right: 0.75rem;
      border: 3px solid gray;
    }
    .info {
      flex-grow: 1;
    }
    .party {
      display: inline-block;
      width: 20px;
      height: 20px;
      border-radius: 50%;
      color: #fff;
      font-size: 0.6rem;
      text-align: center;
      line-height: 20px;
      margin-right: 0.5rem;
    }
    .pin {
      cursor: pointer;
      font-size: 1.2rem;
    }
    .bar-container {
      background: #ddd;
      border-radius: 10px;
      overflow: hidden;
      height: 24px;
      margin: 0.25rem 0;
      position: relative;
    }
    .bar {
      height: 100%;
      line-height: 24px;
      color: #fff;
      padding-left: 8px;
      font-size: 0.75rem;
    }
    .agree {
      background-color: #007aff;
    }
    .disagree {
      background-color: gray;
    }
    .stats {
      font-size: 0.75rem;
      margin-top: 0.5rem;
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <span>726ç½·å…</span>
      <img src="Assets/votingStamp.png" alt="stamp" style="height: 1.75rem" />
    </div>
    <div class="subheader">å³æ™‚é–‹ç¥¨è¿½è¹¤</div>
    <div id="list"></div>
  </div>

  <script>
    const voteURL = "https://gist.githubusercontent.com/hongyinull/d689142242788936e1d220ce4c6977cd/raw/vote_result.json";
    const candidates = [
      { id: "è³´å£«è‘†", name: "è³´å£«è‘†", party: "åœ‹æ°‘é»¨", position: "ç«‹å§”", district: "å°åŒ—å¸‚ç¬¬8é¸å€", threshold726: 61189 },
      { id: "å¾å·§èŠ¯", name: "å¾å·§èŠ¯", party: "åœ‹æ°‘é»¨", position: "ç«‹å§”", district: "å°åŒ—å¸‚ç¬¬7é¸å€", threshold726: 57785 },
      { id: "ç¾…æ™ºå¼·", name: "ç¾…æ™ºå¼·", party: "åœ‹æ°‘é»¨", position: "ç«‹å§”", district: "å°åŒ—å¸‚ç¬¬6é¸å€", threshold726: 57246 },
      { id: "æå½¥ç§€", name: "æå½¥ç§€", party: "åœ‹æ°‘é»¨", position: "ç«‹å§”", district: "å°åŒ—å¸‚ç¬¬4é¸å€", threshold726: 77972 },
      { id: "ç‹é´»è–‡", name: "ç‹é´»è–‡", party: "åœ‹æ°‘é»¨", position: "ç«‹å§”", district: "å°åŒ—å¸‚ç¬¬3é¸å€", threshold726: 68578 },
      { id: "å»–å…ˆç¿”", name: "å»–å…ˆç¿”", party: "åœ‹æ°‘é»¨", position: "ç«‹å§”", district: "æ–°åŒ—å¸‚ç¬¬12é¸å€", threshold726: 66561 },
      { id: "æ—å¾·ç¦", name: "æ—å¾·ç¦", party: "åœ‹æ°‘é»¨", position: "ç«‹å§”", district: "æ–°åŒ—å¸‚ç¬¬9é¸å€", threshold726: 59345 },
      { id: "å¼µæ™ºå€«", name: "å¼µæ™ºå€«", party: "åœ‹æ°‘é»¨", position: "ç«‹å§”", district: "æ–°åŒ—å¸‚ç¬¬8é¸å€", threshold726: 72073 },
      { id: "è‘‰å…ƒä¹‹", name: "è‘‰å…ƒä¹‹", party: "åœ‹æ°‘é»¨", position: "ç«‹å§”", district: "æ–°åŒ—å¸‚ç¬¬7é¸å€", threshold726: 57761 },
      { id: "æ´ªå­Ÿæ¥·", name: "æ´ªå­Ÿæ¥·", party: "åœ‹æ°‘é»¨", position: "ç«‹å§”", district: "æ–°åŒ—å¸‚ç¬¬1é¸å€", threshold726: 101265 },
      { id: "é‚±è‹¥è¯", name: "é‚±è‹¥è¯", party: "åœ‹æ°‘é»¨", position: "ç«‹å§”", district: "æ¡ƒåœ’å¸‚ç¬¬6é¸å€", threshold726: 71261 },
      { id: "å‘‚ç‰ç²", name: "å‘‚ç‰ç²", party: "åœ‹æ°‘é»¨", position: "ç«‹å§”", district: "æ¡ƒåœ’å¸‚ç¬¬5é¸å€", threshold726: 70678 },
      { id: "è¬ç¾ç²", name: "è¬ç¾ç²", party: "åœ‹æ°‘é»¨", position: "ç«‹å§”", district: "æ¡ƒåœ’å¸‚ç¬¬4é¸å€", threshold726: 76672 },
      { id: "é­¯æ˜å“²", name: "é­¯æ˜å“²", party: "åœ‹æ°‘é»¨", position: "ç«‹å§”", district: "æ¡ƒåœ’å¸‚ç¬¬3é¸å€", threshold726: 77251 },
      { id: "æ¶‚æ¬Šå‰", name: "æ¶‚æ¬Šå‰", party: "åœ‹æ°‘é»¨", position: "ç«‹å§”", district: "æ¡ƒåœ’å¸‚ç¬¬2é¸å€", threshold726: 79106 },
      { id: "ç‰›ç…¦åº­", name: "ç‰›ç…¦åº­", party: "åœ‹æ°‘é»¨", position: "ç«‹å§”", district: "æ¡ƒåœ’å¸‚ç¬¬1é¸å€", threshold726: 88517 },
      { id: "æ—æ²›ç¥¥", name: "æ—æ²›ç¥¥", party: "åœ‹æ°‘é»¨", position: "ç«‹å§”", district: "åŸºéš†å¸‚", threshold726: 75995 },
      { id: "é«˜è™¹å®‰", name: "é«˜è™¹å®‰", party: "ç„¡é»¨ç±", position: "å¸‚é•·", district: "æ–°ç«¹å¸‚", threshold726: 90078 },
      { id: "é„­æ­£éˆ", name: "é„­æ­£éˆ", party: "åœ‹æ°‘é»¨", position: "ç«‹å§”", district: "æ–°ç«¹å¸‚", threshold726: 89266 },
      { id: "ç¾…å»·ç‘‹", name: "ç¾…å»·ç‘‹", party: "åœ‹æ°‘é»¨", position: "ç«‹å§”", district: "å°ä¸­å¸‚ç¬¬6é¸å€", threshold726: 69359 },
      { id: "é»ƒå¥è±ª", name: "é»ƒå¥è±ª", party: "åœ‹æ°‘é»¨", position: "ç«‹å§”", district: "å°ä¸­å¸‚ç¬¬5é¸å€", threshold726: 93587 },
      { id: "å»–å‰ç¿”", name: "å»–å‰ç¿”", party: "åœ‹æ°‘é»¨", position: "ç«‹å§”", district: "å°ä¸­å¸‚ç¬¬4é¸å€", threshold726: 84430 },
      { id: "ä¸å­¸å¿ ", name: "ä¸å­¸å¿ ", party: "åœ‹æ°‘é»¨", position: "ç«‹å§”", district: "é›²æ—ç¸£ç¬¬1é¸å€", threshold726: 67916 },
      { id: "å‚…å´è", name: "å‚…å´è", party: "åœ‹æ°‘é»¨", position: "ç«‹å§”", district: "èŠ±è“®ç¸£", threshold726: 47842 },
      { id: "é»ƒå»ºè³“", name: "é»ƒå»ºè³“", party: "åœ‹æ°‘é»¨", position: "ç«‹å§”", district: "å°æ±ç¸£", threshold726: 28347 },
    ];

    function getPartyColor(party) {
      if (party.includes("åœ‹æ°‘é»¨")) return "#455BBA";
      if (party.includes("æ°‘é€²é»¨")) return "#3AC23C";
      return "#999";
    }

    function loadPinned() {
      return JSON.parse(localStorage.getItem("pinned") || "[]");
    }

    function savePinned(pinned) {
      localStorage.setItem("pinned", JSON.stringify(pinned));
    }

    function render(voteResults = []) {
      const pinned = loadPinned();
      const pinnedSet = new Set(pinned);
      const list = document.getElementById("list");
      list.innerHTML = "";

      const sorted = [...candidates].sort((a, b) => {
        return pinnedSet.has(a.id) === pinnedSet.has(b.id)
          ? 0
          : pinnedSet.has(a.id)
          ? -1
          : 1;
      });

      sorted.forEach((c) => {
        const vote = voteResults.find((v) => v.id === c.id);
        const agree = vote?.agree ?? 0;
        const disagree = vote?.disagree ?? 0;
        const turnout = vote ? `${(vote.turnout * 100).toFixed(1)}%` : "ï¼";
        const agreeRatio = Math.min(agree / c.threshold726, 1);
        const disagreeRatio = Math.min(disagree / c.threshold726, 1);

        const div = document.createElement("div");
        div.className = "candidate";
        div.innerHTML = `
          <div class="top">
            <img src="Assets/${c.name}.png" class="avatar" />
            <div class="info">
              <div><strong>${c.name}</strong></div>
              <div>
                <span class="party" style="background:${getPartyColor(c.party)}">${c.party[0]}</span>
                ${c.position}/${c.district}
              </div>
            </div>
            <div class="pin" onclick="togglePin('${c.id}')">
              ${pinnedSet.has(c.id) ? "ğŸ“Œ" : "ğŸ“"}
            </div>
          </div>

          <div class="bar-container">
            <div class="bar agree" style="width:${agreeRatio * 100}%">${agree}</div>
          </div>
          <div class="bar-container">
            <div class="bar disagree" style="width:${disagreeRatio * 100}%">${disagree}</div>
          </div>

          <div class="stats">æŠ•ç¥¨ç‡ï¼š${turnout}</div>
          <div class="stats">åŒæ„ç¥¨é–€æª»ï¼š${c.threshold726.toLocaleString()}</div>
        `;
        list.appendChild(div);
      });
    }

    function togglePin(id) {
      const pinned = loadPinned();
      const idx = pinned.indexOf(id);
      if (idx >= 0) pinned.splice(idx, 1);
      else pinned.push(id);
      savePinned(pinned);
      fetchVotes(); // refresh
    }

    async function fetchVotes() {
      try {
        const res = await fetch(voteURL + "?t=" + Date.now());
        const json = await res.json();
        render(json);
      } catch (e) {
        console.error("ç¥¨æ•¸è¼‰å…¥éŒ¯èª¤", e);
        render();
      }
    }

    setInterval(fetchVotes, 5000);
    fetchVotes();
  </script>
</body>
</html>